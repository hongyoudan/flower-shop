webpackJsonp([24],{"95M1":function(e,t){},H9Oo:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={name:"UserList",data:function(){return{userInfo:[],VAR:this.$VAR,operateRole:this.$store.state.role,operateId:this.$store.state.user.userId,userInfoResource:[],userDialogVisible:!1,roleInfo:[],handleIndex:0,currentRole:[],currentRoleName:"",allotRoles:[],userInfoForm:{key:""}}},methods:{queryUser:function(){if(0!==this.userInfoForm.key.length){this.userInfo=[];for(var e=0,t=this.userInfoResource.length;e<t;e++)-1!==this.userInfoResource[e].userName.indexOf(this.userInfoForm.key)?this.userInfo.push(this.userInfoResource[e]):-1!==this.userInfoResource[e].accountNumber.indexOf(this.userInfoForm.key)&&this.userInfo.push(this.userInfoResource[e])}else this.userInfo=this.userInfoResource},resetForm:function(e){this.$refs[e].resetFields()},isUserState:function(e){var t=this,o=this.$loading({lock:!0,text:"数据提交中",background:"rgba(255,255,255,0.1)"});this.$http.post("/allow/update?userId="+this.userInfo[e].userId+"&userState="+this.userInfo[e].userState).then(function(r){o.close(),200===r.data.code&&(t.userInfo[e].userState?t.$notify({title:"成功",message:t.userInfo[e].userName+"\t已启用",type:"success"}):t.$notify({title:"成功",message:t.userInfo[e].userName+"\t已禁用",type:"success"}))}).catch(function(e){o.close(),t.$msg.error(e)})},allotRole:function(e){var t=this;this.handleIndex=e;var o=this.userInfo[e].userId;this.$http.post("/userRole/findRoleById?userId="+o).then(function(e){if(200===e.data.code){var o=e.data.data;t.currentRole=e.data.data,t.currentRoleName="";for(var r=0;r<t.currentRole.length;r++)t.currentRoleName+=t.currentRole[r].roleName+"\t";0===t.currentRoleName.length&&(t.currentRoleName="暂无角色信息");for(var s=[],n=0;n<o.length;n++)5!==o[n].roleId&&1!==o[n].roleId&&s.push(o[n].roleId);t.allotRoles=s}}).catch(function(e){t.$msg.error(e)}),this.userDialogVisible=!0},deleteUser:function(e,t){var o=this;this.$confirm("此操作将永久删除该用户信息, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var r=o.$loading({lock:!0,text:"数据提交中",background:"rgba(255,255,255,0.1)"});o.$http.post("/user/delete?userId="+o.userInfo[e].userId).then(function(s){r.close(),200===s.data.code?(o.$notify({title:"成功",message:"用户（"+o.userInfo[e].userName+"）\t删除成功",type:"success"}),t.splice(e,1)):o.$notify({title:"错误",message:s.data.message,type:"error"})}).catch(function(e){r.close(),o.$msg.error(e)})}).catch(function(){o.$notify({title:"操作取消",message:"",type:"success"})})},reqInfo:function(){var e=this;this.$http.post("/user/findAll").then(function(t){200===t.data.code&&(e.userInfo=e.userInfoResource=t.data.data)}).catch(function(t){e.$msg.error(t)}),this.$http.post("/role/findAllUsable").then(function(t){if(200===t.data.code){e.roleInfo=t.data.data;for(var o=0;o<e.roleInfo.length;o++)e.roleInfo[o].roleName!==e.$VAR.ordinaryRole&&e.roleInfo[o].roleName!==e.$VAR.adminRole||e.roleInfo.splice(o,1)}}).catch(function(t){e.$msg.error(t)})},submitRole:function(){var e=this;0===this.allotRoles.length?this.$alert("至少选择一个角色","提示",{confirmButtonText:"确定",type:"warning"}):this.$confirm("是否要分配该角色?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){for(var t="",o=0;o<e.currentRole.length;o++)-1!==e.currentRole[o].roleName.indexOf(e.$VAR.adminRole)&&(e.allotRoles.push(e.currentRole[o].roleId),t+=e.currentRole[o].roleName+"、 ");for(var r=0;r<e.allotRoles.length;r++)for(var s=0;s<e.roleInfo.length;s++)e.allotRoles[r]===e.roleInfo[s].roleId&&(t+=e.roleInfo[s].roleName+"、 ");t=t.substring(0,t.length-2),console.log(t);var n=e.$loading({lock:!0,text:"数据提交中",background:"rgba(255,255,255,0.1)"});e.$http.post("/user/author?userId="+e.userInfo[e.handleIndex].userId+"&roleId="+e.allotRoles).then(function(o){n.close(),200===o.data.code?(e.$http.post("/allow/sendHtmlRole?sendTo="+e.userInfo[e.handleIndex].accountNumber+"&userName="+e.userInfo[e.handleIndex].userName+"&roleInfo="+t),e.userDialogVisible=!1,e.$notify({title:"成功",message:"\t角色授权成功",type:"success"})):e.$notify({title:"错误",message:o.data.message,type:"error"})}).catch(function(t){n.close(),e.$msg.error(t)})}).catch(function(){})}},created:function(){this.reqInfo()}},s={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"user-list"},[o("el-card",{staticClass:"user-hd",attrs:{shadow:"never"}},[o("div",{staticStyle:{"text-align":"left"},attrs:{slot:"header"},slot:"header"},[o("i",{staticClass:"el-icon-search"}),e._v(" "),o("span",[e._v("筛选搜索")]),e._v(" "),o("el-button",{staticClass:"el-button-search",staticStyle:{right:"111px"},attrs:{type:"primary"},on:{click:function(t){return e.queryUser()}}},[e._v("查询")]),e._v(" "),o("el-button",{staticClass:"el-button-search",staticStyle:{right:"20px"},on:{click:function(t){return e.resetForm("userInfoForm")}}},[e._v("重置")])],1),e._v(" "),o("el-form",{ref:"userInfoForm",staticClass:"query-form",attrs:{model:e.userInfoForm,inline:""}},[o("el-form-item",{attrs:{label:"输入搜索：",prop:"key"}},[o("el-input",{attrs:{clearable:"",placeholder:"帐号/姓名"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.queryUser()}},model:{value:e.userInfoForm.key,callback:function(t){e.$set(e.userInfoForm,"key",t)},expression:"userInfoForm.key"}})],1)],1)],1),e._v(" "),o("el-card",{staticClass:"user-box",attrs:{shadow:"never"}},[o("div",{staticStyle:{"text-align":"left",position:"relative"},attrs:{slot:"header"},slot:"header"},[o("i",{staticClass:"el-icon-coin"}),e._v(" "),o("span",[e._v("数据列表")])]),e._v(" "),o("el-table",{staticClass:"type-table",staticStyle:{width:"100%"},attrs:{data:e.userInfo,height:"425",border:""}},[o("el-table-column",{attrs:{prop:"userId",label:"编号",width:"100"}}),e._v(" "),o("el-table-column",{attrs:{prop:"accountNumber",label:"帐号",width:"200"}}),e._v(" "),o("el-table-column",{attrs:{prop:"userName",label:"姓名",width:"150"}}),e._v(" "),o("el-table-column",{attrs:{prop:"telephone",label:"手机号",width:"200"}}),e._v(" "),o("el-table-column",{attrs:{prop:"creatTime",label:"注册时间",width:"200"}}),e._v(" "),o("el-table-column",{attrs:{prop:"loginTime",label:"最后登录",width:"200"}}),e._v(" "),o("el-table-column",{attrs:{label:"是否启用",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-switch",{attrs:{disabled:e.operateId===t.row.userId||t.row.userName===e.VAR.adminRole},on:{change:function(o){return e.isUserState(t.$index)}},model:{value:e.userInfo[t.$index].userState,callback:function(o){e.$set(e.userInfo[t.$index],"userState",o)},expression:"userInfo[scope.$index].userState"}})]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"操作",align:"center","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{staticStyle:{margin:"0 2%"},attrs:{size:"mini"},on:{click:function(o){return e.allotRole(t.$index)}}},[e._v("分配角色")]),e._v(" "),o("el-tooltip",{attrs:{disabled:null!==e.operateRole&&-1!==e.operateRole.indexOf(e.VAR.adminRole),content:"超级管理员才有删除权限",placement:"bottom",effect:"light"}},[o("span",[o("el-button",{staticStyle:{margin:"0 2%"},attrs:{size:"mini",type:"danger",disabled:e.operateId===t.row.userId||null!==e.operateRole&&-1===e.operateRole.indexOf(e.VAR.adminRole)},on:{click:function(o){return e.deleteUser(t.$index,e.userInfo)}}},[e._v("删除")])],1)])]}}])})],1)],1),e._v(" "),o("el-dialog",{staticClass:"user-dialog",attrs:{title:"分配角色",visible:e.userDialogVisible,width:"30%",distinguishCancelAndClose:""},on:{"update:visible":function(t){e.userDialogVisible=t}}},[o("div",{staticStyle:{"text-align":"left",width:"80%",margin:"0 auto"}},[0!==e.userInfo.length?o("h3",{staticStyle:{"margin-top":"0"}},[e._v("姓名:\n        "),o("el-tooltip",{attrs:{effect:"dark",content:e.currentRoleName,placement:"right"}},[-1!==e.currentRoleName.indexOf(e.VAR.adminRole)?o("el-tag",{attrs:{type:"warning"}},[e._v(e._s(e.userInfo[e.handleIndex].userName))]):-1!==e.currentRoleName.indexOf(e.VAR.ordinaryRole)?o("el-tag",{attrs:{type:"success"}},[e._v(e._s(e.userInfo[e.handleIndex].userName))]):-1!==e.currentRoleName.indexOf("暂无角色信息")?o("el-tag",{attrs:{type:"info"}},[e._v(e._s(e.userInfo[e.handleIndex].userName))]):o("el-tag",{attrs:{type:"danger"}},[e._v(e._s(e.userInfo[e.handleIndex].userName))])],1)],1):e._e(),e._v(" "),o("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择角色"},model:{value:e.allotRoles,callback:function(t){e.allotRoles=t},expression:"allotRoles"}},e._l(e.roleInfo,function(e){return o("el-option",{key:e.roleId,attrs:{label:e.roleName,value:e.roleId}})}),1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{size:"small"},on:{click:function(t){e.userDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.submitRole}},[e._v("确 定")])],1)])],1)},staticRenderFns:[]};var n=o("VU/8")(r,s,!1,function(e){o("95M1")},null,null);t.default=n.exports}});
//# sourceMappingURL=24.49ed5e7cde7f0a3dc7da.js.map