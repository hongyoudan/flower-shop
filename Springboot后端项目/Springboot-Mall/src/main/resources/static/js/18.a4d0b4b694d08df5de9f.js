webpackJsonp([18],{"31NE":function(t,e){},QwzQ:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("mvHQ"),o=a.n(s),r=a("Mpzp"),n={name:"ShoppingCart",components:{MallFooter:a("loKF").a},data:function(){return{tableData:null,selectedData:[],summation:0,options:r.regionData,addressForm:{selectedOptions:[],detailAddress:""},addressRules:{selectedOptions:[{validator:function(t,e,a){null===e||0===e.length?a(new Error("请选择收货地址")):a()},trigger:"blur"}],detailAddress:[{validator:function(t,e,a){null===e||0===e.trim().length?a(new Error("请填写详细地址")):a()},trigger:"blur"}]},addressFormVisible:!1,orderFormVisible:!1,orders:[],baseInfo:{userName:this.$store.state.user.userName,contactWay:"",payMoney:0,acceptAddress:this.$store.state.user.userAddress},baseInfoRules:{userName:[{validator:function(t,e,a){null===e||0===e.trim().length?a(new Error("请填写收货人")):a()},trigger:"blur"}],contactWay:[{validator:function(t,e,a){null===e||0===e.trim().length?a(new Error("请填写联系方式")):/^((0\d{2,3}-\d{7,8})|(1[3584]\d{9}))$/.test(e)?a():a(new Error("请填写正确的手机号"))},trigger:"blur"}],acceptAddress:[{validator:function(t,e,a){null===e||0===e.trim().length?a(new Error("请填写收货地址")):a()},trigger:"blur"}]}}},methods:{submitForm:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return!1;for(var a="",s=e.addressForm.selectedOptions,o=0,n=s.length;o<n;o++)a+=r.CodeToText[s[o]]+" ";a+="("+e.addressForm.detailAddress+")",e.baseInfo.acceptAddress=a,e.addressFormVisible=!1})},buy:function(){var t=this;this.baseInfo.payMoney=this.summation,null!==this.baseInfo.userName&&0===this.baseInfo.userName.length&&(this.baseInfo.userName=this.$store.state.user.userName),null!==this.baseInfo.contactWay&&0===this.baseInfo.contactWay.length?null===this.$store.state.user.telephone||0===this.$store.state.user.telephone.length?this.$confirm("检测到您未绑定手机号，快递小哥哥将无法找到您","提示",{confirmButtonText:"现在绑定",cancelButtonText:"临时填写",type:"warning"}).then(function(){t.$router.push("/personalCenter")}).catch(function(){t.orderFormVisible=!0}):(this.baseInfo.contactWay=this.$store.state.user.telephone,this.orderFormVisible=!0):this.orderFormVisible=!0},createOrder:function(){var t=this;this.orders.length=0;for(var e=0,a=this.selectedData.length;e<a;e++){var s={orderNo:this.getDateNow(),userAccount:this.$store.state.user.accountNumber,productNo:this.selectedData[e].productNo,payPrice:this.selectedData[e].totalPrice,productSpecs:this.selectedData[e].productSpecs,payAmount:this.selectedData[e].payAmount,userName:this.baseInfo.userName,contactWay:this.baseInfo.contactWay,payType:"支付宝",orderFrom:"网页商城",orderState:"待付款",returnState:!1,acceptAddress:this.baseInfo.acceptAddress};this.orders.push(s)}var r=Math.floor(9e4*Math.random()+1e4+1),n={orderNo:r,ordersInfo:o()(this.orders)},i=this.$loading({lock:!0,text:"订单处理中",background:"rgba(255,255,255,0.1)"});this.$http.post("/order/cartOrder",this.$qs.stringify(n)).then(function(e){if(i.close(),200===e.data.code){for(var a=e.data.data.split(","),s=0,o=0,n=t.selectedData.length;o<n;o++)for(var l=0;l<a.length;l++)t.selectedData[o].productNo===a[l]&&(s+=Number(t.selectedData[o].totalPrice));var c="共"+a.length+"商品购买成功，需支付 "+s+" 元";t.$alert(c,"下单成功",{confirmButtonText:"确定",type:"success",callback:function(){var e=t.getCurrentDate()+"花卷商城-"+t.baseInfo.userName+"购物车支付订单",a=t.baseInfo.payMoney,s=t.$loading({lock:!0,text:"正在跳转支付页面",background:"rgba(255,255,255,0.1)"});t.$http.post("/alipay/create?orderNo="+r+"&orderName="+e+"&payPrice="+a).then(function(t){s.close();var e=document.createElement("div");e.innerHTML=t.data,document.body.appendChild(e),document.forms[document.forms.length-1].submit()}).catch(function(e){s.close(),t.$msg.error(e)})}})}}).catch(function(e){i.close(),t.$msg.error(e)}),this.orderFormVisible=!1},getCurrentDate:function(){var t=new Date;return String(t.getFullYear())+"-"+String(t.getMonth()+1)+"-"+String(t.getDate())+" "+String(t.getHours())+":"+String(t.getMinutes())+" "},getDateNow:function(){var t=new Date,e=String(t.getFullYear());e=e.substring(2);var a=String(t.getMonth()+1),s=String(t.getDate()),o=String(t.getHours());o.length<2&&(o="0"+o);var r=String(t.getSeconds());r.length<2&&(r="0"+r);return e+a+s+o+r+Math.floor(9e3*Math.random()+1e3+1)},calculationPrice:function(t){this.tableData[t].totalPrice=(this.tableData[t].payAmount*Math.floor(this.tableData[t].productPrice*this.tableData[t].discount/100)).toFixed(2),this.summation=0;for(var e=0,a=this.selectedData.length;e<a;e++)this.summation+=Number(this.selectedData[e].totalPrice);var s={};s.cartId=this.tableData[t].cartId,s.payAmount=this.tableData[t].payAmount,this.$http.post("/shoppingCart/update",this.$qs.stringify(s))},deleteProduct:function(t){var e=this;this.$confirm("此商品将从购物车中移除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a=e.$loading({lock:!0,text:"数据提交中",background:"rgba(255,255,255,0.1)"});e.$http.post("/shoppingCart/deleteById?cartId="+e.tableData[t].cartId).then(function(t){a.close(),200===t.data.code&&(e.reqInfo(),e.$message({type:"success",message:"移除成功!"}))}).catch(function(t){a.close(),e.$msg.error(t)})}).catch(function(){})},handleSelectionChange:function(t){this.summation=0,this.selectedData=t;for(var e=0,a=this.selectedData.length;e<a;e++)this.summation+=Number(this.selectedData[e].totalPrice)},goShopping:function(){this.$router.push({path:"/MallHome"})},clearCart:function(){var t=this;this.$confirm("是否清空购物车？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e=t.$loading({lock:!0,text:"数据处理中",background:"rgba(255,255,255,0.1)"});t.$http.post("/shoppingCart/deleteByUser?accountNumber="+t.$store.state.user.accountNumber).then(function(a){e.close(),200===a.data.code&&(t.reqInfo(),t.$message({type:"success",message:"购物车已清空!"}))}).catch(function(a){e.close(),t.$msg.error(a)})}).catch(function(){})},reqInfo:function(){var t=this,e=this.$loading({lock:!0,text:"数据加载中",background:"rgba(255,255,255,0.1)"});this.$http.post("/shoppingCart/findAll?accountNumber="+this.$store.state.user.accountNumber).then(function(a){e.close();var s=t.$store.state.user.isVip;if(200===a.data.code){t.tableData=a.data.data;for(var o=0,r=t.tableData.length;o<r;o++)s?(t.tableData[o].discount=98,t.tableData[o].productPrice>=1e3&&t.tableData[o].productPrice<5e3?t.tableData[o].discount=95:t.tableData[o].productPrice>=5e3&&(t.tableData[o].discount=90)):t.tableData[o].discount=100,t.tableData[o].totalPrice=(t.tableData[o].payAmount*Math.floor(t.tableData[o].productPrice*t.tableData[o].discount/100)).toFixed(2)}}).catch(function(a){e.close(),t.$msg.error(a)})}},created:function(){this.reqInfo()}},i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"shopping-cart"},[this.tableData&&0!==t.tableData.length?a("el-button",{staticClass:"clear-cart",attrs:{type:"primary",icon:"el-icon-delete-solid",title:"清空购物车",circle:""},on:{click:t.clearCart}}):t._e(),t._v(" "),a("div",{staticClass:"product-box"},[a("div",{staticClass:"nav-bar"},[a("div",{staticClass:"container"},[a("router-link",{staticStyle:{"text-decoration":"none"},attrs:{to:"/MallHome",title:"花卷官网"}},[a("el-image",{staticClass:"logo",staticStyle:{width:"55px",height:"55px","margin-top":"10px","margin-right":"15px"},attrs:{src:"https://spring-oss.oss-cn-beijing.aliyuncs.com/images/img/lg.png"}})],1),t._v(" "),t._m(0)],1)])]),t._v(" "),t.tableData?a("div",{staticClass:"page-main"},[0!==t.tableData.length?a("div",{staticClass:"cart-info"},[a("el-table",{ref:"cartTable",staticStyle:{width:"100%"},attrs:{data:t.tableData,"tooltip-effect":"dark","highlight-current-row":!1},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{label:"商品名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("router-link",{staticStyle:{"text-decoration":"none"},attrs:{to:"/MallPurchase?id="+e.row.productId}},[a("div",{staticClass:"product-name"},[a("el-image",{staticClass:"product-img",attrs:{src:e.row.productUrl}}),t._v(" "),a("span",{staticClass:"name"},[t._v(t._s(e.row.productName))])],1)])]}}],null,!1,3707555281)}),t._v(" "),a("el-table-column",{attrs:{prop:"productSpecs",label:"规格",width:"150"}}),t._v(" "),a("el-table-column",{attrs:{label:"单价",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.productPrice)+"元")])]}}],null,!1,1148243720)}),t._v(" "),a("el-table-column",{attrs:{label:"数量",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input-number",{attrs:{size:"small",min:1,max:e.row.productStock},on:{change:function(a){return t.calculationPrice(e.$index)}},model:{value:e.row.payAmount,callback:function(a){t.$set(e.row,"payAmount",a)},expression:"scope.row.payAmount"}})]}}],null,!1,2385296710)}),t._v(" "),a("el-table-column",{attrs:{label:"会员折扣",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[100===e.row.discount?a("span",[t._v("无")]):a("el-tag",{attrs:{type:"warning"}},[t._v(t._s(e.row.discount)+"折")])]}}],null,!1,3467878154)}),t._v(" "),a("el-table-column",{attrs:{label:"小计",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{color:"#ff6700"}},[t._v(t._s(e.row.totalPrice)+"元")])]}}],null,!1,3493584861)}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(a){return t.deleteProduct(e.$index)}}})]}}],null,!1,68031349)})],1),t._v(" "),a("div",{staticClass:"cart-bar"},[a("div",{staticClass:"section-left"},[a("router-link",{staticStyle:{"text-decoration":"none"},attrs:{to:"/MallHome"}},[a("span",{staticClass:"to-shop"},[t._v("\n              继续购物\n            ")])]),t._v(" "),a("el-divider",{attrs:{direction:"vertical"}}),t._v(" "),a("span",[t._v("\n            共\n            "),a("span",{staticStyle:{color:"#FF6700"}},[t._v(t._s(this.tableData.length))]),t._v("\n            件商品，已选择\n            "),a("span",{staticStyle:{color:"#FF6700"}},[t._v(t._s(this.selectedData.length))]),t._v("\n            件\n          ")])],1),t._v(" "),a("div",{staticClass:"section-right"},[a("span",{staticClass:"total"},[t._v("\n            合计：\n            "),a("span",{staticStyle:{"font-size":"30px"}},[t._v(t._s(t.summation))]),t._v("\n            元\n          ")]),t._v(" "),t.selectedData?a("el-tooltip",{attrs:{content:"请勾选需要结算的商品",disabled:0!==t.selectedData.length,placement:"top",effect:"light"}},[a("div",{staticClass:"button"},[a("el-button",{staticStyle:{height:"100%",width:"100%"},attrs:{type:"danger",disabled:0===t.selectedData.length},on:{click:t.buy}},[t._v("去结算")])],1)]):t._e()],1)])],1):a("div",{staticClass:"empty-cart-top"},[a("h2",[t._v("\n        您的购物车还是空的！\n      ")]),t._v(" "),a("el-button",{attrs:{type:"success"},on:{click:t.goShopping}},[t._v("马上去购物")])],1)]):t._e(),t._v(" "),a("el-dialog",{staticClass:"address-dialog",attrs:{title:"收货地址",width:"450px",visible:t.addressFormVisible},on:{"update:visible":function(e){t.addressFormVisible=e}}},[a("el-form",{ref:"addressForm",attrs:{model:t.addressForm,rules:t.addressRules}},[a("el-form-item",{attrs:{label:"所在地区",prop:"selectedOptions"}},[a("el-cascader",{attrs:{size:"large",options:t.options,separator:" "},model:{value:t.addressForm.selectedOptions,callback:function(e){t.$set(t.addressForm,"selectedOptions",e)},expression:"addressForm.selectedOptions"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"详细地址",prop:"detailAddress"}},[a("el-input",{staticStyle:{width:"auto"},attrs:{autocomplete:"off"},model:{value:t.addressForm.detailAddress,callback:function(e){t.$set(t.addressForm,"detailAddress",e)},expression:"addressForm.detailAddress"}},[a("i",{staticClass:"el-icon-edit el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})])],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.addressFormVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitForm("addressForm")}}},[t._v("确 定")])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"订单信息",visible:t.orderFormVisible,width:"600px"},on:{"update:visible":function(e){t.orderFormVisible=e}}},[a("el-form",{ref:"order",staticClass:"order-form",attrs:{model:t.baseInfo,rules:t.baseInfoRules}},[a("el-form-item",{attrs:{label:"收货人",prop:"userName"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:t.baseInfo.userName,callback:function(e){t.$set(t.baseInfo,"userName",e)},expression:"baseInfo.userName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"联系方式",prop:"contactWay"}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:t.baseInfo.contactWay,callback:function(e){t.$set(t.baseInfo,"contactWay",e)},expression:"baseInfo.contactWay"}})],1),t._v(" "),a("el-form-item",{staticStyle:{position:"relative"},attrs:{label:"收货地址",prop:"acceptAddress"}},[a("el-input",{attrs:{readonly:""},model:{value:t.baseInfo.acceptAddress,callback:function(e){t.$set(t.baseInfo,"acceptAddress",e)},expression:"baseInfo.acceptAddress"}}),t._v(" "),a("el-button",{staticStyle:{position:"absolute",top:"1px",right:"14px",border:"none"},attrs:{plain:""},on:{click:function(e){t.addressFormVisible=!0}}},[t._v("修改")])],1),t._v(" "),a("el-form-item",{attrs:{label:"预计支付"}},[a("el-input",{attrs:{readonly:""},model:{value:t.baseInfo.payMoney+" 元",callback:function(e){t.$set(t.baseInfo,"payMoney+' 元'",e)},expression:"baseInfo.payMoney+' 元'"}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.createOrder("order")}}},[t._v("付 款")]),t._v(" "),a("el-button",{on:{click:function(e){t.orderFormVisible=!1}}},[t._v("取 消")])],1)],1),t._v(" "),a("MallFooter")],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticStyle:{display:"inline-block",position:"absolute",top:"15px"}},[e("h2",[this._v("我的购物车")]),this._v(" "),e("div",{staticClass:"tip"},[e("span",[this._v("温馨提示：产品是否购买成功，以最终下单为准哦，请尽快结算")])])])}]};var l=a("VU/8")(n,i,!1,function(t){a("31NE")},null,null);e.default=l.exports}});
//# sourceMappingURL=18.a4d0b4b694d08df5de9f.js.map