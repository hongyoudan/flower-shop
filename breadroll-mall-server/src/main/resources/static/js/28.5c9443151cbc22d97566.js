webpackJsonp([28],{Vlpp:function(e,t){},X5SK:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={name:"UserList",data:function(){return{userInfo:[],VAR:this.$VAR,operateRole:this.$store.state.role,operateId:this.$store.state.user.userId,userInfoResource:[],userDialogVisible:!1,roleInfo:[],handleIndex:0,currentRole:[],currentRoleName:"",allotRoles:[],userInfoForm:{key:""}}},methods:{queryUser:function(){if(0!==this.userInfoForm.key.length){this.userInfo=[];for(var e=0,t=this.userInfoResource.length;e<t;e++)-1!==this.userInfoResource[e].userName.indexOf(this.userInfoForm.key)?this.userInfo.push(this.userInfoResource[e]):-1!==this.userInfoResource[e].accountNumber.indexOf(this.userInfoForm.key)&&this.userInfo.push(this.userInfoResource[e])}else this.userInfo=this.userInfoResource},resetForm:function(e){this.$refs[e].resetFields()},isUserState:function(e){var t=this,r=this.$loading({lock:!0,text:"数据提交中",background:"rgba(255,255,255,0.1)"});this.$http.post("/allow/update?userId="+this.userInfo[e].userId+"&userState="+this.userInfo[e].userState).then(function(o){r.close(),200===o.data.code&&(t.userInfo[e].userState?t.$notify({title:"成功",message:t.userInfo[e].userName+"\t已启用",type:"success"}):t.$notify({title:"成功",message:t.userInfo[e].userName+"\t已禁用",type:"success"}))}).catch(function(e){r.close(),t.$msg.error(e)})},allotRole:function(e){var t=this;this.handleIndex=e;var r=this.userInfo[e].userId;this.$http.post("/userRole/findRoleById?userId="+r).then(function(e){if(200===e.data.code){var r=e.data.data;t.currentRole=e.data.data,t.currentRoleName="";for(var o=0;o<t.currentRole.length;o++)t.currentRoleName+=t.currentRole[o].roleName+"\t";0===t.currentRoleName.length&&(t.currentRoleName="暂无角色信息");for(var s=[],n=0;n<r.length;n++)5!==r[n].roleId&&1!==r[n].roleId&&s.push(r[n].roleId);t.allotRoles=s}}).catch(function(e){t.$msg.error(e)}),this.userDialogVisible=!0},deleteUser:function(e,t){var r=this;this.$confirm("此操作将永久删除该用户信息, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var o=r.$loading({lock:!0,text:"数据提交中",background:"rgba(255,255,255,0.1)"});r.$http.post("/user/delete?userId="+r.userInfo[e].userId).then(function(s){o.close(),200===s.data.code?(r.$notify({title:"成功",message:"用户（"+r.userInfo[e].userName+"）\t删除成功",type:"success"}),t.splice(e,1)):r.$notify({title:"错误",message:s.data.message,type:"error"})}).catch(function(e){o.close(),r.$msg.error(e)})}).catch(function(){r.$notify({title:"操作取消",message:"",type:"success"})})},reqInfo:function(){var e=this;this.$http.post("/user/findAll/admin").then(function(t){200===t.data.code&&(e.userInfo=e.userInfoResource=t.data.data)}).catch(function(t){e.$msg.error(t)}),this.$http.post("/role/findAllUsable").then(function(t){200===t.data.code&&(e.roleInfo=t.data.data.filter(function(e){return e.roleName!==VAR.adminRole&&e.roleName!==VAR.ordinaryRole}))}).catch(function(t){e.$msg.error(t)})},submitRole:function(){var e=this;0===this.allotRoles.length?this.$alert("至少选择一个角色","提示",{confirmButtonText:"确定",type:"warning"}):this.$confirm("是否要分配该角色?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){for(var t="",r=0;r<e.currentRole.length;r++)-1!==e.currentRole[r].roleName.indexOf(e.$VAR.adminRole)&&(e.allotRoles.push(e.currentRole[r].roleId),t+=e.currentRole[r].roleName+"、 ");for(var o=0;o<e.allotRoles.length;o++)for(var s=0;s<e.roleInfo.length;s++)e.allotRoles[o]===e.roleInfo[s].roleId&&(t+=e.roleInfo[s].roleName+"、 ");t=t.substring(0,t.length-2),console.log(t);var n=e.$loading({lock:!0,text:"数据提交中",background:"rgba(255,255,255,0.1)"});e.$http.post("/user/author?userId="+e.userInfo[e.handleIndex].userId+"&roleId="+e.allotRoles).then(function(r){n.close(),200===r.data.code?(e.$http.post("/allow/sendHtmlRole?email="+e.userInfo[e.handleIndex].accountNumber+"&userName="+e.userInfo[e.handleIndex].userName+"&roleInfo="+t),e.userDialogVisible=!1,e.$notify({title:"成功",message:"\t角色授权成功",type:"success"})):e.$notify({title:"错误",message:r.data.message,type:"error"})}).catch(function(t){n.close(),e.$msg.error(t)})}).catch(function(){})}},created:function(){this.reqInfo()}},s={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"user-list"},[r("el-card",{staticClass:"user-hd",attrs:{shadow:"never"}},[r("div",{staticStyle:{"text-align":"left"},attrs:{slot:"header"},slot:"header"},[r("i",{staticClass:"el-icon-search"}),e._v(" "),r("span",[e._v("筛选搜索")]),e._v(" "),r("el-button",{staticClass:"el-button-search",staticStyle:{right:"111px"},attrs:{type:"primary"},on:{click:function(t){return e.queryUser()}}},[e._v("查询")]),e._v(" "),r("el-button",{staticClass:"el-button-search",staticStyle:{right:"20px"},on:{click:function(t){return e.resetForm("userInfoForm")}}},[e._v("重置")])],1),e._v(" "),r("el-form",{ref:"userInfoForm",staticClass:"query-form",attrs:{model:e.userInfoForm,inline:""}},[r("el-form-item",{attrs:{label:"输入搜索",prop:"key"}},[r("el-input",{attrs:{clearable:"",placeholder:"帐号/姓名"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.queryUser()}},model:{value:e.userInfoForm.key,callback:function(t){e.$set(e.userInfoForm,"key",t)},expression:"userInfoForm.key"}})],1)],1)],1),e._v(" "),r("el-card",{staticClass:"user-box",attrs:{shadow:"never"}},[r("div",{staticStyle:{"text-align":"left",position:"relative"},attrs:{slot:"header"},slot:"header"},[r("i",{staticClass:"el-icon-coin"}),e._v(" "),r("span",[e._v("数据列表")])]),e._v(" "),r("el-table",{staticClass:"type-table",staticStyle:{width:"100%"},attrs:{data:e.userInfo,height:"425",border:""}},[r("el-table-column",{attrs:{prop:"userId",label:"编号",width:"100"}}),e._v(" "),r("el-table-column",{attrs:{prop:"accountNumber",label:"帐号",width:"200"}}),e._v(" "),r("el-table-column",{attrs:{prop:"userName",label:"姓名",width:"150"}}),e._v(" "),r("el-table-column",{attrs:{prop:"telephone",label:"手机号",width:"200"}}),e._v(" "),r("el-table-column",{attrs:{prop:"creatTime",label:"注册时间",width:"200"}}),e._v(" "),r("el-table-column",{attrs:{prop:"loginTime",label:"最后登录",width:"200"}}),e._v(" "),r("el-table-column",{attrs:{label:"是否启用",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-switch",{attrs:{disabled:e.operateId===t.row.userId||t.row.userName===e.VAR.adminRole},on:{change:function(r){return e.isUserState(t.$index)}},model:{value:e.userInfo[t.$index].userState,callback:function(r){e.$set(e.userInfo[t.$index],"userState",r)},expression:"userInfo[scope.$index].userState"}})]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"操作",align:"center","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{staticStyle:{margin:"0 2%"},attrs:{size:"mini"},on:{click:function(r){return e.allotRole(t.$index)}}},[e._v("分配角色")]),e._v(" "),r("el-button",{staticStyle:{margin:"0 2%"},attrs:{size:"mini",type:"danger",title:"超级管理员才有删除权限",disabled:e.operateId===t.row.userId||null!==e.operateRole&&-1===e.operateRole.indexOf(e.VAR.adminRole)},on:{click:function(r){return e.deleteUser(t.$index,e.userInfo)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),r("el-dialog",{staticClass:"user-dialog",attrs:{title:"分配角色",visible:e.userDialogVisible,width:"30%",distinguishCancelAndClose:""},on:{"update:visible":function(t){e.userDialogVisible=t}}},[r("div",{staticStyle:{"text-align":"left",width:"80%",margin:"0 auto"}},[0!==e.userInfo.length?r("h3",{staticStyle:{"margin-top":"0"}},[e._v("姓名:\n        "),r("el-tooltip",{attrs:{effect:"dark",content:e.currentRoleName,placement:"right"}},[-1!==e.currentRoleName.indexOf(e.VAR.adminRole)?r("el-tag",{attrs:{type:"warning"}},[e._v("\n            "+e._s(e.userInfo[e.handleIndex].userName)+"\n          ")]):-1!==e.currentRoleName.indexOf(e.VAR.ordinaryRole)?r("el-tag",{attrs:{type:"success"}},[e._v("\n            "+e._s(e.userInfo[e.handleIndex].userName)+"\n          ")]):-1!==e.currentRoleName.indexOf("暂无角色信息")?r("el-tag",{attrs:{type:"info"}},[e._v("\n            "+e._s(e.userInfo[e.handleIndex].userName)+"\n          ")]):r("el-tag",{attrs:{type:"danger"}},[e._v(e._s(e.userInfo[e.handleIndex].userName))])],1)],1):e._e(),e._v(" "),r("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择角色"},model:{value:e.allotRoles,callback:function(t){e.allotRoles=t},expression:"allotRoles"}},e._l(e.roleInfo,function(e){return r("el-option",{key:e.roleId,attrs:{label:e.roleName,value:e.roleId}})}),1)],1),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.userDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.submitRole}},[e._v("确 定")])],1)])],1)},staticRenderFns:[]};var n=r("VU/8")(o,s,!1,function(e){r("Vlpp")},null,null);t.default=n.exports}});
//# sourceMappingURL=28.5c9443151cbc22d97566.js.map